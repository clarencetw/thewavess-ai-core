# ç®¡ç†å“¡ç³»çµ±ä½¿ç”¨æŒ‡å—

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

æœ¬ç³»çµ±å¯¦ç¾äº†**ç¨ç«‹çš„ç®¡ç†å“¡ç³»çµ±**ï¼Œèˆ‡ä¸€èˆ¬ç”¨æˆ¶å®Œå…¨åˆ†é›¢ï¼š

- **ç”¨æˆ¶ç³»çµ±** (`users` è¡¨): æœå‹™çš„çµ‚ç«¯ç”¨æˆ¶  
- **ç®¡ç†å“¡ç³»çµ±** (`admins` è¡¨): å¾Œå°ç®¡ç†äººå“¡

## ğŸ” ç®¡ç†å“¡å¸³è™Ÿ

### é è¨­ç®¡ç†å“¡å¸³è™Ÿ

ç³»çµ±æä¾›ä»¥ä¸‹é è¨­ç®¡ç†å“¡å¸³è™Ÿï¼ˆé€šé fixtures.yml è¼‰å…¥ï¼‰ï¼š

| ç”¨æˆ¶å | å¯†ç¢¼ | è§’è‰² | æ¬Šé™ |
|--------|------|------|------|
| `admin` | `admin123456` | è¶…ç´šç®¡ç†å“¡ | æ‰€æœ‰æ¬Šé™ (`*`) |
| `manager` | `manager123456` | ä¸€èˆ¬ç®¡ç†å“¡ | åŸºæœ¬ç®¡ç†æ¬Šé™ (`basic`) |

### å®‰å…¨å»ºè­°

âš ï¸ **é‡è¦**: ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨å‰è«‹å‹™å¿…ä¿®æ”¹é è¨­å¯†ç¢¼ï¼

## ğŸ­ è§’è‰²èˆ‡æ¬Šé™

### ç®¡ç†å“¡è§’è‰²

1. **super_admin** (è¶…ç´šç®¡ç†å“¡)
   - æ¬Šé™: `*` (æ‰€æœ‰æ¬Šé™)
   - ç”¨é€”: ç³»çµ±ç®¡ç†ã€ç®¡ç†å“¡ç®¡ç†ã€æ‰€æœ‰å¾Œå°åŠŸèƒ½

2. **admin** (ä¸€èˆ¬ç®¡ç†å“¡)  
   - æ¬Šé™: `basic` (åŸºæœ¬ç®¡ç†æ¬Šé™)
   - ç”¨é€”: åŸºæœ¬ç®¡ç†åŠŸèƒ½ï¼Œä¸åŒ…æ‹¬ç®¡ç†å“¡ç®¡ç†

### æ¬Šé™ç³»çµ±

æ¬Šé™ç³»çµ±ï¼š
- `*` - æ‰€æœ‰æ¬Šé™ (åƒ…è¶…ç´šç®¡ç†å“¡æ“æœ‰)
- `basic` - åŸºæœ¬ç®¡ç†æ¬Šé™ (ä¸€èˆ¬ç®¡ç†å“¡)

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. åˆå§‹åŒ–ç®¡ç†å“¡ç³»çµ±

```bash
# å…¨æ–°é–‹å§‹ (æ¨è–¦)
make fresh-start

# å¿«é€Ÿè¨­ç½® (åƒ…è³‡æ–™åº«+fixtures)  
make quick-setup

# åƒ…é‡æ–°è¼‰å…¥ fixtures (åŒ…å«ç®¡ç†å“¡)
make fixtures-recreate

# æˆ–æ‰‹å‹•åŸ·è¡Œ
make migrate-reset
make migrate
make fixtures
```

### 2. ç®¡ç†å“¡ç™»å…¥

```bash
curl -X POST "http://localhost:8080/api/v1/admin/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123456"
  }'
```

éŸ¿æ‡‰æœƒåŒ…å«ç®¡ç†å“¡JWTä»¤ç‰Œï¼š

```json
{
  "success": true,
  "data": {
    "admin": {...},
    "access_token": "eyJ...",
    "token_type": "Bearer",
    "expires_in": 28800
  }
}
```

### 3. ä½¿ç”¨ç®¡ç†å“¡API

```bash
# ç²å–ç®¡ç†å“¡å€‹äººè³‡æ–™
curl -H "Authorization: Bearer <admin_token>" \
  "http://localhost:8080/api/v1/admin/profile"

# ç²å–ç®¡ç†å“¡åˆ—è¡¨ï¼ˆéœ€è¦è¶…ç´šç®¡ç†å“¡æ¬Šé™ï¼‰
curl -H "Authorization: Bearer <super_admin_token>" \
  "http://localhost:8080/api/v1/admin/admins"
```

## ğŸ“¡ API ç«¯é»ï¼ˆ9å€‹ç®¡ç†ç³»çµ±ç«¯é»ï¼‰

### èªè­‰ç›¸é—œ
- `POST /admin/auth/login` - ç®¡ç†å“¡ç™»å…¥

### ç®¡ç†å“¡ç®¡ç†
- `GET /admin/profile` - ç²å–å€‹äººè³‡æ–™ (æ‰€æœ‰ç®¡ç†å“¡)
- `GET /admin/admins` - ç®¡ç†å“¡åˆ—è¡¨ (åƒ…è¶…ç´šç®¡ç†å“¡)
- `POST /admin/admins` - å‰µå»ºç®¡ç†å“¡ (åƒ…è¶…ç´šç®¡ç†å“¡)

### ç³»çµ±ç®¡ç†
- `GET /admin/stats` - ç³»çµ±çµ±è¨ˆ (æ‰€æœ‰ç®¡ç†å“¡)
- `GET /admin/logs` - ç³»çµ±æ—¥èªŒ (æ‰€æœ‰ç®¡ç†å“¡)

### ç”¨æˆ¶ç®¡ç†  
- `GET /admin/users` - ç”¨æˆ¶åˆ—è¡¨ (æ‰€æœ‰ç®¡ç†å“¡)
- `PUT /admin/users/:id` - æ›´æ–°ç”¨æˆ¶ (æ‰€æœ‰ç®¡ç†å“¡)

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### JWT ä»¤ç‰Œ

- **æœ‰æ•ˆæœŸ**: 8å°æ™‚ï¼ˆæ¯”ç”¨æˆ¶ä»¤ç‰ŒçŸ­ï¼‰
- **ç°½å**: å°ˆç”¨ç°½å (`thewavess-ai-core-admin`)  
- **åŒ…å«**: ç®¡ç†å“¡IDã€è§’è‰²ã€æ¬Šé™åˆ—è¡¨

### å¸³è™Ÿå®‰å…¨

- **å¯†ç¢¼åŠ å¯†**: bcrypt åŠ å¯†å­˜å„²
- **å¤±æ•—é–å®š**: 5æ¬¡å¤±æ•—å¾Œé–å®š30åˆ†é˜
- **æ¬Šé™æª¢æŸ¥**: æ¯å€‹APIéƒ½æœ‰æ¬Šé™é©—è­‰

### ä¸­é–“ä»¶

- `AdminMiddleware()` - é©—è­‰ç®¡ç†å“¡ä»¤ç‰Œ  
- `RequireSuperAdmin()` - æª¢æŸ¥è¶…ç´šç®¡ç†å“¡æ¬Šé™

## ğŸ§ª é–‹ç™¼èˆ‡æ¸¬è©¦

### å‰µå»ºç®¡ç†å“¡

```bash
# ä½¿ç”¨APIå‰µå»ºï¼ˆéœ€è¦super_adminæ¬Šé™ï¼‰
curl -X POST "http://localhost:8080/api/v1/admin/admins" \
  -H "Authorization: Bearer <super_admin_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "new_admin",
    "email": "new@example.com", 
    "password": "secure_password",
    "role": "admin"
  }'
```

### æ¸¬è©¦

```bash
# æ¸¬è©¦ç®¡ç†å“¡ç™»å…¥
curl -X POST "http://localhost:8080/api/v1/admin/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123456"}'

# æ¸¬è©¦ç®¡ç†å“¡API
curl -H "Authorization: Bearer <token>" \
  "http://localhost:8080/api/v1/admin/profile"
```

### è³‡æ–™åº«ç›´æ¥æŸ¥è©¢

```sql
-- æŸ¥çœ‹æ‰€æœ‰ç®¡ç†å“¡
SELECT username, email, role, status, permissions FROM admins;

-- æª¢æŸ¥æ¬Šé™
SELECT username, role, permissions FROM admins WHERE status = 'active';
```

## ğŸ“ é–‹ç™¼æ³¨æ„äº‹é …

### è·¯ç”±è¨­è¨ˆ

- ç®¡ç†å“¡èªè­‰è·¯ç”±ç„¡éœ€ä¸­é–“ä»¶: `/admin/auth/*`
- ç®¡ç†å“¡APIéœ€è¦ç®¡ç†å“¡ä¸­é–“ä»¶: `/admin/*` 
- ç®¡ç†å“¡ç®¡ç†åŠŸèƒ½éœ€è¦ `RequireSuperAdmin()` ä¸­é–“ä»¶

### æ¬Šé™è¨­è¨ˆ

- è¶…ç´šç®¡ç†å“¡ (`super_admin`) æ“æœ‰æ‰€æœ‰æ¬Šé™
- ä¸€èˆ¬ç®¡ç†å“¡ (`admin`) æ“æœ‰åŸºæœ¬ç®¡ç†æ¬Šé™
- åªæœ‰è¶…ç´šç®¡ç†å“¡å¯ä»¥ç®¡ç†å…¶ä»–ç®¡ç†å“¡

### å®‰å…¨è€ƒæ…®

- ç®¡ç†å“¡ä»¤ç‰Œä¸å¯ç”¨æ–¼ç”¨æˆ¶API
- ç”¨æˆ¶ä»¤ç‰Œä¸å¯ç”¨æ–¼ç®¡ç†å“¡API  
- æ•æ„Ÿæ“ä½œéœ€è¦è¨˜éŒ„æ—¥èªŒ
- ç”Ÿç”¢ç’°å¢ƒè«‹ä¿®æ”¹é è¨­å¯†ç¢¼

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **ç®¡ç†å“¡ç™»å…¥å¤±æ•—**
   - æª¢æŸ¥ç”¨æˆ¶å/å¯†ç¢¼æ˜¯å¦æ­£ç¢º
   - æª¢æŸ¥å¸³è™Ÿæ˜¯å¦è¢«é–å®š
   - æŸ¥çœ‹ `failed_attempts` å’Œ `locked_until` æ¬„ä½

2. **æ¬Šé™ä¸è¶³éŒ¯èª¤**
   - æª¢æŸ¥ç®¡ç†å“¡è§’è‰²å’Œæ¬Šé™
   - ç¢ºèªAPIç«¯é»éœ€è¦çš„æ¬Šé™
   - è¶…ç´šç®¡ç†å“¡å¯è¨ªå•æ‰€æœ‰ç«¯é»

3. **ä»¤ç‰Œç„¡æ•ˆ**
   - æª¢æŸ¥ä»¤ç‰Œæ˜¯å¦éæœŸï¼ˆ8å°æ™‚ï¼‰
   - ç¢ºèªä½¿ç”¨çš„æ˜¯ç®¡ç†å“¡ä»¤ç‰Œï¼Œä¸æ˜¯ç”¨æˆ¶ä»¤ç‰Œ
   - æª¢æŸ¥ `Authorization: Bearer <token>` æ ¼å¼

### æ—¥èªŒæª¢æŸ¥

```bash
# æª¢æŸ¥ç®¡ç†å“¡æ“ä½œæ—¥èªŒ
grep "ç®¡ç†å“¡" server.log

# æª¢æŸ¥èªè­‰å¤±æ•—
grep "ç™»å…¥å¤±æ•—" server.log
```

## ğŸš€ æœªä¾†æ“´å±•

- [ ] ç®¡ç†å“¡æ“ä½œæ—¥èªŒå¯©è¨ˆ
- [ ] æ›´ç´°ç·»çš„æ¬Šé™æ§åˆ¶ï¼ˆè³‡æºç´šåˆ¥ï¼‰  
- [ ] ç®¡ç†å“¡å¯†ç¢¼ç­–ç•¥è¨­å®š
- [ ] é›™å› å­èªè­‰ï¼ˆ2FAï¼‰
- [ ] ç®¡ç†å“¡æœƒè©±ç®¡ç†