<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thewavess AI Core - æ¸¬è©¦ä»‹é¢</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .chat-container { border: 1px solid #ddd; height: 400px; overflow-y: auto; padding: 15px; margin: 20px 0; background: #f9f9f9; }
        .message { margin: 10px 0; padding: 10px; border-radius: 8px; }
        .user-message { background: #e3f2fd; text-align: right; }
        .ai-message { background: #fff3e0; }
        .scene-description { background: #f3e5f5; font-style: italic; margin: 5px 0; padding: 8px; border-radius: 4px; }
        .character-action { color: #666; font-size: 14px; margin-top: 5px; }
        .emotion-state { font-size: 12px; color: #888; margin-top: 5px; }
        input[type="text"] { width: 70%; padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .send-btn { background: #2196F3; color: white; }
        .clear-btn { background: #f44336; color: white; }
        .status { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ¤– Thewavess AI Core æ¸¬è©¦</h1>
    
    <div id="status" class="status"></div>
    
    <div class="chat-container" id="chatContainer">
        <div class="message ai-message">
            <div class="scene-description">è¾¦å…¬å®¤è£¡ç‡ˆå…‰å¾®æš–ï¼Œé™¸å¯’æ·µæ­£å°ˆæ³¨åœ°è™•ç†æ–‡ä»¶...</div>
            <div><strong>é™¸å¯’æ·µï¼š</strong>æ­¡è¿ä¾†åˆ°æˆ‘çš„è¾¦å…¬å®¤ï¼Œæœ‰ä»€éº¼äº‹å—ï¼Ÿ</div>
            <div class="character-action">ä»–æŠ¬èµ·é ­ï¼Œæ·±é‚ƒçš„çœ¼çœ¸æ³¨è¦–è‘—ä½ </div>
            <div class="emotion-state">å¥½æ„Ÿåº¦: 50 | é—œä¿‚: é™Œç”Ÿäºº | å¿ƒæƒ…: neutral</div>
        </div>
    </div>
    
    <div>
        <input type="text" id="messageInput" placeholder="è¼¸å…¥ä½ æƒ³èªªçš„è©±..." onkeypress="handleKeyPress(event)">
        <button class="send-btn" onclick="sendMessage()">ç™¼é€</button>
        <button class="clear-btn" onclick="clearChat()">æ¸…ç©º</button>
    </div>
    
    <div style="margin-top: 20px; font-size: 14px; color: #666;">
        <p><strong>ä½¿ç”¨èªªæ˜ï¼š</strong></p>
        <ul>
            <li>ç›´æ¥è¼¸å…¥è¨Šæ¯èˆ‡é™¸å¯’æ·µå°è©±</li>
            <li>ç³»çµ±æœƒè‡ªå‹•ç”Ÿæˆå ´æ™¯æè¿°å’Œè§’è‰²å‹•ä½œ</li>
            <li>å¥½æ„Ÿåº¦å’Œé—œä¿‚ç‹€æ…‹æœƒæ ¹æ“šå°è©±å…§å®¹è®ŠåŒ–</li>
            <li>æŒ‰ Enter éµæˆ–é»æ“Šç™¼é€æŒ‰éˆ•ç™¼é€è¨Šæ¯</li>
        </ul>
    </div>

    <script>
        let sessionId = 'web_test_' + Date.now();
        let messageCount = 0;

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;

            // é¡¯ç¤ºç”¨æˆ¶è¨Šæ¯
            addUserMessage(message);
            input.value = '';

            // ç™¼é€åˆ° API
            fetch('/api/v1/test/message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    session_id: sessionId,
                    message: message
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addAIMessage(data.data);
                    showStatus('âœ… è¨Šæ¯ç™¼é€æˆåŠŸ', 'success');
                } else {
                    showStatus('âŒ éŒ¯èª¤: ' + (data.error?.message || 'æœªçŸ¥éŒ¯èª¤'), 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showStatus('âŒ ç¶²è·¯éŒ¯èª¤: ' + error.message, 'error');
            });
        }

        function addUserMessage(message) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user-message';
            messageDiv.innerHTML = `<div><strong>ä½ ï¼š</strong>${escapeHtml(message)}</div>`;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function addAIMessage(data) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai-message';
            
            let html = '';
            
            // å ´æ™¯æè¿°
            if (data.scene_description) {
                html += `<div class="scene-description">${escapeHtml(data.scene_description)}</div>`;
            }
            
            // è§’è‰²å°è©±
            html += `<div><strong>é™¸å¯’æ·µï¼š</strong>${escapeHtml(data.character_response.message)}</div>`;
            
            // è§’è‰²å‹•ä½œ
            if (data.character_action) {
                html += `<div class="character-action">${escapeHtml(data.character_action)}</div>`;
            }
            
            // æƒ…æ„Ÿç‹€æ…‹
            const emotion = data.emotional_state;
            html += `<div class="emotion-state">å¥½æ„Ÿåº¦: ${emotion.affection} | é—œä¿‚: ${emotion.relationship} | å¿ƒæƒ…: ${emotion.mood}</div>`;
            
            messageDiv.innerHTML = html;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function clearChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = `
                <div class="message ai-message">
                    <div class="scene-description">è¾¦å…¬å®¤è£¡ç‡ˆå…‰å¾®æš–ï¼Œé™¸å¯’æ·µæ­£å°ˆæ³¨åœ°è™•ç†æ–‡ä»¶...</div>
                    <div><strong>é™¸å¯’æ·µï¼š</strong>æ­¡è¿ä¾†åˆ°æˆ‘çš„è¾¦å…¬å®¤ï¼Œæœ‰ä»€éº¼äº‹å—ï¼Ÿ</div>
                    <div class="character-action">ä»–æŠ¬èµ·é ­ï¼Œæ·±é‚ƒçš„çœ¼çœ¸æ³¨è¦–è‘—ä½ </div>
                    <div class="emotion-state">å¥½æ„Ÿåº¦: 50 | é—œä¿‚: é™Œç”Ÿäºº | å¿ƒæƒ…: neutral</div>
                </div>
            `;
            sessionId = 'web_test_' + Date.now();
            messageCount = 0;
            showStatus('ğŸ’¬ å°è©±å·²é‡ç½®', 'success');
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
            setTimeout(() => {
                status.textContent = '';
                status.className = 'status';
            }, 3000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºç‹€æ…‹
        window.onload = function() {
            showStatus('ğŸš€ æ¸¬è©¦ä»‹é¢å·²æº–å‚™å°±ç·’', 'success');
        };
    </script>
</body>
</html>