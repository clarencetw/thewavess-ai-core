# AI驅動情感系統指南

## 系統概述

本系統採用**完全AI驅動的情感分析**，不再依賴固定規則，而是讓AI智能判斷每次對話的情感變化。

### 🧠 AI智能情感分析
- **動態評估**：AI根據對話內容、語境、角色性格動態判斷好感度變化
- **範圍控制**：每次變化 -10 到 +10 分，確保合理的情感波動
- **雙引擎支持**：OpenAI GPT-4o 和 Grok 引擎均支持情感分析

## 好感度分級系統

| 好感度範圍 | 關係狀態 | 親密等級 | 系統行為 |
|----------|---------|---------|----------|
| 90-100 | soulmate | intimate | 深度情感交流，主動表達愛意 |
| 80-89 | intimate | intimate | 親密關係，偶爾撒嬌 |
| 70-79 | close | close | 親密朋友，溫暖互動 |
| 60-69 | close | casual | 熟悉朋友，友好對話 |
| 40-59 | friend | casual | 普通朋友，禮貌互動 |
| 20-39 | friend | distant | 初步朋友，保持距離 |
| 0-19 | stranger | distant | 陌生人，正式對話 |

## AI情感分析機制

### 📊 情感變化輸出格式
```json
{
  "emotion_delta": {
    "affection_change": 3,           // 好感度變化 (-10 到 +10)
    "mood_change": "開心愉悅",         // 心情變化描述  
    "trigger": "用戶表達關心",         // 觸發原因
    "confidence": 0.9                // AI信心度 (Grok引擎)
  },
  "mood": "happy",                   // 當前心情狀態
  "relationship": "friend",          // 當前關係狀態
  "intimacy_level": "casual"         // 當前親密等級
}
```

### 🎯 AI考量因素
AI在判斷情感變化時會綜合考慮：

1. **對話內容**：關心、讚美、批評、冷淡等表達
2. **語氣情感**：溫暖、冷漠、激動、悲傷等情緒
3. **歷史互動**：過往對話記錄和關係發展軌跡
4. **角色個性**：不同角色對相同內容的反應差異
5. **對話長度**：投入度和認真程度的體現
6. **NSFW信任**：親密內容帶來的信任加成

## 技術實現架構

### 🏗️ 核心流程
1. **用戶輸入** → NSFW內容分析
2. **AI引擎選擇** → 根據內容等級選擇 OpenAI 或 Grok
3. **情感智能分析** → AI輸出結構化的情感變化數據
4. **數據庫更新** → 更新 relationships 表中的好感度和狀態
5. **歷史記錄** → 情感變化事件記錄到 emotion_data.history

### 📝 數據持久化
- **主表**：`relationships` - 存儲當前好感度和關係狀態
- **歷史追蹤**：`emotion_data.history` - JSONB格式的情感變化記錄
- **實時更新**：每次對話自動觸發情感狀態更新

## NSFW與情感關聯

### 🔒 信任度機制
AI會根據NSFW內容等級給予不同程度的信任加成：
- **Level 2-3**：輕度親密內容，適度增加好感
- **Level 4-5**：高度親密內容，顯著提升信任度
- **門檻控制**：高等級內容需要相應的好感度基礎

### 📱 動態調整
不同好感度階段的AI行為差異：
- **低好感度** (0-39)：保守回應，專業距離感
- **中好感度** (40-79)：友好互動，偶爾親近
- **高好感度** (80-100)：主動表達情感，深度交流

## 優勢特色

### ✨ AI驅動優勢
1. **智能理解**：深度理解對話語境和隱含情感
2. **個性化反應**：不同角色展現獨特的情感模式
3. **動態適應**：根據用戶行為模式動態調整
4. **自然發展**：避免機械化規則，情感發展更自然

### 🔄 持續學習
- AI引擎不斷優化情感判斷準確性
- 支持未來新增情感分析維度
- 可擴展的JSON格式支持更豐富的情感數據

---

*本系統完全基於AI智能分析，提供比傳統規則系統更自然、更個性化的情感體驗。*