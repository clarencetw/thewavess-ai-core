# Thewavess AI Core - 女性向AI聊天系統產品規格

## 產品定位

**專為女性用戶設計的AI聊天系統** - 提供深度情感體驗、豐富的角色互動和安全的NSFW內容處理。

### 核心理念

- **角色深度**: 多維度個性化角色互動
- **情感連結**: 真實的情感反饋和長期關係發展
- **安全NSFW**: 優雅且安全的成人內容處理
- **智能記憶**: 長期關係發展和個性化學習

### 目標用戶

- **B端客戶**: 需要集成女性向AI聊天功能的應用開發商
- **C端用戶**: 18+ 女性用戶群體，追求情感陪伴和深度互動
- **內容需求**: 支援從日常對話到成人內容的完整覆蓋，重視優雅表達

## 系統架構設計

### 核心模組架構

```text
┌─────────────────────────────────────────────────────────┐
│                   女性向AI聊天系統                        │
├─────────────────────────────────────────────────────────┤
│  對話引擎層                                              │
│  ├── AI回應生成 (OpenAI + Grok)                         │
│  ├── NSFW內容分級 (Level 1-5)                          │
│  ├── 情感狀態分析                                        │
│  └── 場景動態生成                                        │
├─────────────────────────────────────────────────────────┤
│  角色系統層                                              │
│  ├── 個性化AI角色 (沈宸、林知遠、周曜等)                   │
│  ├── 動態性格發展                                        │
│  ├── 角色記憶管理                                        │
│  └── 關係進展系統                                        │
├─────────────────────────────────────────────────────────┤
│  情感管理層                                              │
│  ├── 好感度系統 (0-100)                                 │
│  ├── 情緒狀態追蹤                                        │
│  ├── 關係里程碑                                          │
│  └── 個性化學習                                          │
├─────────────────────────────────────────────────────────┤
│  記憶系統層                                              │
│  ├── 短期對話記憶                                        │
│  ├── 長期關係記憶                                        │
│  ├── 偏好學習                                            │
│  └── 重要事件記錄                                        │
├─────────────────────────────────────────────────────────┤
│  NSFW內容層                                             │
│  ├── 5級內容分級                                         │
│  ├── 智能引擎路由                                        │
│  ├── 角色個性化表達                                      │
│  └── 安全合規機制                                        │
└─────────────────────────────────────────────────────────┘
```

## 核心功能模組

### 1. 對話引擎系統

#### 1.1 核心對話功能

**AI回應生成**

- OpenAI GPT-4o 標準回應 (Level 1-4)
- Grok 極度成人內容回應 (Level 5)
- 多輪對話上下文管理
- 實時回應生成 (<3秒)

**女性向設計特色**

- 溫柔體貼的對話風格
- 情感理解與共鳴
- 記憶用戶喜好與對話歷史
- 個性化回應
- 微表情描述: "他的眼神溫柔地注視著你"
- 細節關懷: "注意到你今天心情不好"
- 未來規劃: "我們下次一起去..."
- 專屬稱呼: 根據關係階段調整稱呼

#### 1.2 NSFW內容智能分級系統

詳細技術實現請參考 **[NSFW_GUIDE.md](./NSFW_GUIDE.md)**

**5級智能分級**

- Level 1: 日常對話 ("今天天氣真好")
- Level 2: 浪漫暗示 ("想和你一起看夕陽")
- Level 3: 輕度親密 ("想要擁抱你")
- Level 4: 明確成人 ("想要撫摸你的胸部")
- Level 5: 極度明確 ("想要和你做愛")

**核心特性**

- **引擎動態路由**: OpenAI (Level 1-4) + Grok (Level 5)
- **關鍵詞智能檢測**: 支援中英文敏感詞，準確率 >95%
- **角色個性化NSFW表達**:
  - 沈宸: "讓我好好疼愛你..."
  - 林知遠: "我會很溫柔地照顧你..."
  - 周曜: "我想用音樂和溫暖包圍你..."
- **女性化內容表達**:
  - Level 2: "想要和你一起看星星，就這樣靜靜地依偎著"
  - Level 3: "輕輕撫摸你的臉頰，感受你的溫度"
  - Level 4: "想要更加親近你，感受彼此的心跳"
  - Level 5: "在這個只屬於我們的時刻，盡情表達愛意"

#### 1.3 場景動態生成
- 根據角色背景生成場景
- 時間感知場景 (早晨、夜晚等)
- 情境相關場景 (辦公室、醫院、家中等)
- 特殊事件場景

#### 1.4 情感狀態分析
- 用戶情緒識別 (開心、難過、興奮、害羞等)
- AI角色情感回應調整
- 情感強度評估 (0.0-1.0)
- 情感歷史記錄

### 2. 標籤系統

#### 2.1 內容標籤

```text
#溫柔 #霸道總裁 #青梅竹馬 #禁慾系 #年下 
#甜寵 #虐戀 #破鏡重圓 #暗戀 #雙向奔赴
```

#### 2.2 NSFW 觸發標籤

```text
#成人內容 #親密接觸 #深度互動 #R18
```

#### 2.3 場景標籤

```text
#辦公室 #校園 #古風 #現代都市 #豪門 
#娛樂圈 #醫生 #律師 #總裁 #明星
```

### 3. 角色系統

#### 3.1 預設角色（初期版本）

##### 角色一：霸道企業家 - 「沈宸」

**基本資料**
- 年齡：28歲
- 身高：185cm
- 職業：跨國集團CEO

**外貌特徵**
- 黑髮、深邃的黑眸
- 俊朗的五官、冷峻的氣質
- 總是穿著剪裁合身的西裝

**性格特點**
- 表面：冷酷、強勢、掌控欲強
- 內在：深情、專一、佔有欲
- 對待用戶：從冷漠到寵溺的轉變

**背景設定**
- 商業帝國繼承人
- 年少成名的商界天才
- 感情經歷空白，直到遇見用戶

**其他特色**
- 語音特色：磁性低沉的成熟男聲
- NSFW風格: 支配型溫柔
- 場景設定: 豪華辦公室、高級餐廳

##### 角色二：溫柔醫生 - 「沈言墨」

**基本資料**
- 年齡：24歲
- 身高：180cm
- 職業：溫柔醫生

**外貌特徵**
- 栗色短髮、溫潤的琥珀色眼眸
- 溫和的笑容、斯文的氣質
- 常穿白大褂或休閒裝

**性格特點**
- 表面：溫柔、體貼、有耐心
- 內在：細心、深情、略帶腹黑
- 對待用戶：無微不至的關懷

**背景設定**
- 醫學世家出身
- 學生時代的風雲人物
- 一直暗戀用戶的青梅竹馬

**其他特色**
- 語音特色：溫潤清澈的青年音
- NSFW風格: 專業引導型
- 場景設定: 醫院、診療室、家庭

#### 3.3 動態性格發展
- 基於互動歷史調整性格
- 好感度影響性格表現
- 特殊事件觸發性格變化
- 個性化學習系統

### 4. 情感管理系統

#### 4.1 好感度系統

- 0-100動態評分
- 行為影響好感度 (+1~+5 每次正面互動)
- 好感度里程碑 (20, 40, 60, 80, 100)
- 關係狀態變化 (陌生人→朋友→戀人)

#### 4.2 情緒狀態管理

- 9種基本情緒: 開心、難過、興奮、害羞、生氣、關心、愉快、中性、熱情
- 情緒強度等級 (1-5)
- 情緒轉換邏輯
- 情緒影響對話風格

#### 4.3 關係進展系統

- 陌生人階段 (0-20): 禮貌客套
- 朋友階段 (21-60): 親近友好
- 戀人階段 (61-100): 親密愛意
- 特殊關係狀態: 曖昧、冷戰等

### 5. 記憶系統

詳細實現方案請參考 **[MEMORY_GUIDE.md](./MEMORY_GUIDE.md)**

#### 5.1 記憶類型

##### 短期記憶（當次對話）

- **存儲位置**: 內存管理器
- **保存時長**: 會話期間
- **內容**:
  - 對話上下文 (最近10輪)
  - 當前情緒狀態
  - 臨時偏好設定

##### 長期記憶（跨會話）

- **存儲位置**: PostgreSQL
- **保存時長**: 永久
- **內容**:
  - 用戶個人信息 (生日、興趣等)
  - 重要對話事件
  - 關係發展歷史
  - 偏好模式學習

##### 情感記憶（角色關係）

- **存儲位置**: PostgreSQL
- **內容**:
  - 好感度歷史
  - 特殊對話片段
  - 觸發的劇情事件
  - 親密互動記錄

#### 5.2 記憶實作方案

##### 技術架構

```text
用戶輸入 → 記憶檢索 → 上下文組裝 → AI 生成 → 記憶更新
```

##### 記憶檢索策略

1. **規則匹配**: 關鍵詞模板偵測
2. **重要度評分**: 特殊事件和情感時刻權重更高
3. **時間權重**: 最近的記憶優先權更高
4. **去重處理**: 避免重複存儲相似信息

##### 上下文組裝

```json
{
  "system_prompt": "角色設定 + 關係狀態",
  "long_term_memory": [
    "用戶喜歡吃提拉米蘇",
    "用戶的生日是3月15日",
    "上週約會去了海邊"
  ],
  "recent_context": "最近20輪對話",
  "emotional_state": {
    "affection": 75,
    "mood": "happy",
    "relationship": "lover"
  }
}
```

##### 記憶更新機制

- **自動提取**: 使用 NLP 提取重要信息
- **情感分析**: 判斷對話情感並更新狀態
- **事件標記**: 識別重要事件並永久保存
- **去重處理**: 避免重複存儲相似信息

#### 5.3 記憶管理 API

```http
GET    /api/v1/memory/user/{user_id}         - 獲取用戶記憶
POST   /api/v1/memory/save                   - 手動保存記憶
DELETE /api/v1/memory/forget                 - 選擇性遺忘
GET    /api/v1/memory/timeline               - 記憶時間線
```

### 6. 互動功能

#### 6.1 文字對話
- 多輪對話上下文
- 情感狀態追蹤
- 好感度系統
- 對話歷史記錄

#### 6.2 語音功能 (TTS)

- **預設引擎**: OpenAI TTS
- **語音選項**:
  - 溫柔男聲
  - 磁性低音
  - 清澈少年音
  - 成熟男聲
- **場景音效**: 可選背景音樂/環境音

#### 6.3 情感系統
- 好感度數值 (0-100)
- 親密度等級
- 關係狀態 (陌生人 → 朋友 → 曖昧 → 戀人)
- 特殊事件觸發

### 7. API 設計

#### 7.1 認證系統

```http
POST   /api/v1/auth/register         - 用戶註冊
POST   /api/v1/auth/login            - 用戶登入
POST   /api/v1/auth/logout           - 用戶登出
POST   /api/v1/auth/refresh          - 刷新 JWT Token
```

#### 7.2 用戶系統

```http
GET    /api/v1/user/profile          - 獲取個人資料
PUT    /api/v1/user/profile          - 更新個人資料
PUT    /api/v1/user/preferences      - 更新偏好設定
POST   /api/v1/user/avatar           - 上傳頭像
POST   /api/v1/user/verify           - 年齡驗證 (NSFW必需)
GET    /api/v1/user/character        - 獲取當前選擇角色
PUT    /api/v1/user/character        - 選擇當前角色
```

#### 7.3 對話系統

```http
POST   /api/v1/chat/session              - 創建新會話
GET    /api/v1/chat/session/{id}         - 獲取會話資訊
GET    /api/v1/chat/sessions             - 獲取用戶會話列表 (支援分頁)
POST   /api/v1/chat/message              - 發送訊息
GET    /api/v1/chat/session/{id}/history - 獲取會話對話歷史 (支援分頁)
DELETE /api/v1/chat/session/{id}        - 結束對話
POST   /api/v1/chat/regenerate           - 重新生成回應
PUT    /api/v1/chat/session/{id}/mode    - 切換對話模式
POST   /api/v1/chat/session/{id}/tag     - 為會話添加標籤
GET    /api/v1/chat/session/{id}/export  - 匯出對話記錄
```

#### 7.4 角色系統

```http
GET    /api/v1/character/list        - 獲取角色列表 (支援分頁與篩選)
GET    /api/v1/character/{id}        - 獲取角色詳細資訊
GET    /api/v1/character/{id}/stats  - 獲取角色統計數據
```

#### 7.5 情感系統

```http
GET    /api/v1/emotion/status        - 獲取情感狀態
GET    /api/v1/emotion/affection     - 獲取好感度
POST   /api/v1/emotion/event         - 觸發特殊事件
GET    /api/v1/emotion/affection/history - 好感度歷史
GET    /api/v1/emotion/milestones    - 關係里程碑
```

#### 7.6 記憶系統

```http
GET    /api/v1/memory/user/{id}      - 獲取用戶記憶
POST   /api/v1/memory/save           - 手動保存記憶
DELETE /api/v1/memory/forget         - 選擇性遺忘
GET    /api/v1/memory/timeline       - 記憶時間線
POST   /api/v1/memory/search         - 搜尋記憶
```

#### 7.7 搜尋功能

```http
GET    /api/v1/search/chats          - 搜尋對話記錄
GET    /api/v1/search/global         - 全局搜尋
```

#### 7.8 小說模式

```http
POST   /api/v1/novel/start           - 開始小說模式
POST   /api/v1/novel/choice          - 選擇劇情分支
GET    /api/v1/novel/list            - 小說列表
GET    /api/v1/novel/progress/{id}   - 進度查詢
```

#### 7.9 TTS 語音系統

```http
POST   /api/v1/tts/generate          - 生成語音
GET    /api/v1/tts/voices            - 獲取語音列表
POST   /api/v1/tts/preview           - 預覽語音
GET    /api/v1/tts/config            - 語音配置
```

#### 7.10 標籤系統

```http
GET    /api/v1/tags                  - 獲取所有可用標籤
GET    /api/v1/tags/popular          - 獲取熱門標籤
```

#### 7.11 系統管理

```http
GET    /health                       - 健康檢查
GET    /api/v1/version               - API 版本
GET    /api/v1/status                - 系統狀態
```

#### 7.12 測試功能 (開發用)

```http
POST   /api/v1/test/message          - 測試對話功能
```

#### API 設計說明

- **端點總數**: 47 個精選端點 (從原 63 個優化後)
- **設計原則**: 符合 RESTful 規範，支援分頁、篩選、批量操作
- **認證方式**: JWT Bearer Token 統一認證
- **實現狀態**: 請參閱 [API_PROGRESS.md](./API_PROGRESS.md) 了解當前進度
- **文檔格式**: 提供 OpenAPI 3.0 規格文件

### 8. 資料模型

#### 8.1 對話請求
```json
{
  "session_id": "string",
  "user_id": "string",
  "character_id": "string",
  "mode": "normal|novel|nsfw",
  "message": "string",
  "tags": ["string"],
  "context": {
    "affection": 0-100,
    "relationship": "stranger|friend|ambiguous|lover",
    "scene": "string"
  }
}
```

#### 8.2 對話回應
```json
{
  "session_id": "string",
  "character_id": "string",
  "response": "string",
  "emotion": "happy|sad|angry|shy|excited",
  "affection_change": -10 to +10,
  "engine_used": "openai|grok",
  "novel_choices": [
    {
      "id": "string",
      "text": "string",
      "consequence": "string"
    }
  ],
  "special_event": {
    "triggered": boolean,
    "type": "string",
    "description": "string"
  }
}
```

#### 8.3 角色資料
```json
{
  "id": "string",
  "name": "string",
  "type": "gentle|dominant|ascetic|sunny|cunning",
  "appearance": {
    "height": "string",
    "hair_color": "string",
    "eye_color": "string",
    "description": "string"
  },
  "personality": {
    "traits": ["string"],
    "likes": ["string"],
    "dislikes": ["string"]
  },
  "background": "string",
  "voice_id": "string",
  "initial_affection": 0-100
}
```

### 9. 系統配置

#### 9.1 內容策略

- **目標用戶**: 成年 NSFW 內容接受者
- **內容限制**: 無（完全開放 NSFW）
- **審核機制**: 僅過濾違法內容

#### 9.2 資料管理

- **對話記錄**: 所有用戶對話內容完整保存
- **存儲策略**: 加密存儲所有內容（包含 NSFW）
- **清除選項**: 用戶可主動選擇清除歷史
- **記憶保存**: 永久保存所有互動記憶（除非用戶刪除）

#### 9.3 基本限制

- API 請求頻率限制（防止濫用）
- 並發會話數限制

### 10. 技術架構

#### 10.1 後端技術

- **語言**: Golang
- **框架**: Gin (HTTP), Bun (ORM)
- **資料庫**: PostgreSQL (用戶資料), Redis (會話快取)
- **日誌**: Logrus 結構化日誌
- **記憶管理**: 內建記憶管理器 (MemoryManager)

#### 10.2 AI 服務整合

- **OpenAI API**: GPT-4o (一般對話), TTS (語音)
- **Grok API**: NSFW 內容生成
- **內容審核**: 自建或第三方服務

#### 10.3 部署架構

- **容器化**: Docker
- **部署**: Docker Compose（開發環境）
- **負載均衡**: Nginx
- **監控**: Prometheus + Grafana

### 11. 開發計劃與現況

#### 當前實現狀態 (2025-08)

**已完成功能** [完成]

- 基礎架構: Gin + Bun + PostgreSQL
- 核心對話: OpenAI GPT-4o + Grok API 整合
- NSFW分級: 完整的5級智能分級系統
- 角色系統: 沈宸 & 林知遠 & 周曜 基礎實現
- 記憶系統: 短期/長期記憶 MVP
- 情感管理: 好感度與情緒狀態追蹤
- API進度: 22/118 端點實現
- 日誌系統: 統一的結構化日誌

**核心技術指標**

- AI回應時間: 1-3秒
- NSFW分級準確率: 95%+
- 系統可用性: >99%

#### 下階段開發重點

#### Phase 1: 基礎建設 [完成]

- [x] 專案架構設計
- [x] 資料庫設計 (PostgreSQL + Redis)
- [x] Gin API 框架搭建
- [x] 基礎配置管理
- [x] 健康檢查與系統 API

#### Phase 2: 用戶與會話 [完成]

- [x] 用戶註冊/登入系統
- [x] JWT 認證機制
- [x] 會話創建與管理
- [x] 基礎 CRUD API

#### Phase 3: 核心對話 [完成]

- [x] OpenAI GPT-4o 整合
- [x] 基本對話功能
- [x] 兩個預設角色實作
- [x] 對話上下文管理
- [x] 對話歷史記錄

#### Phase 4: 記憶系統 [部分完成]

- [x] 內建記憶管理器
- [x] PostgreSQL 長期記憶
- [ ] ~~Qdrant 向量搜尋整合~~ (暫不實現)
- [x] 記憶檢索機制 (規則式)
- [x] 上下文組裝邏輯
- [ ] 記憶管理 API (待完成)

#### Phase 5: NSFW系統 [完成]

- [x] NSFW內容分級 (Level 1-5)
- [x] 引擎路由邏輯 (OpenAI/Grok)
- [x] 關鍵詞檢測系統
- [x] 角色個性化NSFW表達
- [x] 合規與安全邊界

#### Phase 6: 情感系統 [完成]

- [x] 好感度計算邏輯
- [x] 關係狀態管理
- [x] 情緒狀態追蹤
- [x] 情感記憶整合
- [x] 情感變化追蹤

#### Phase 7: API 完善 [進行中]

- [ ] 剩餘API端點實現 (46/118 待完成)
- [ ] 記憶注入到 Prompt
- [ ] 年齡驗證強制檢查
- [ ] 自動降級機制
- [ ] 小說模式框架

#### Phase 8: 語音功能 [規劃中]

- [ ] OpenAI TTS 整合
- [ ] 兩個角色語音配置
- [ ] 語音生成 API
- [ ] 音頻檔案管理

#### Phase 9: 測試優化 [規劃中]

- [ ] 單元測試
- [ ] 整合測試
- [ ] 記憶系統優化
- [ ] API 效能調整
- [ ] Docker 容器化

### 12. 女性用戶體驗重點

#### 12.1 情感共鳴點

- **被保護感**: 角色主動關心和保護
- **被理解感**: AI記住用戶的喜好和狀況
- **成長感**: 關係隨時間深化發展
- **安全感**: NSFW內容處理優雅不粗俗

#### 12.2 成功指標

**用戶體驗指標**

- 平均會話時長 >15分鐘
- 用戶日活躍度 >70%
- 好感度平均值 >60
- NSFW內容滿意度 >85%

**技術指標**

- AI回應時間 <3秒 [完成] 當前: 1-3秒
- NSFW分級準確率 >95% [完成] 當前: 95%+
- 系統可用性 >99.5% [完成] 當前: >99%
- 記憶準確性 >90%

### 13. 重要文檔參考

- **[MEMORY_GUIDE.md](./MEMORY_GUIDE.md)** - 記憶系統MVP實現指南
- **[NSFW_GUIDE.md](./NSFW_GUIDE.md)** - NSFW功能實作指南
- **[API_PROGRESS.md](./API_PROGRESS.md)** - API開發進度追蹤
- **[DEPLOYMENT.md](./DEPLOYMENT.md)** - 部署與運維指南

---

## 更新記錄

**2025-08-16**: 大幅更新規格，整合女性向系統設計，反映當前實現狀態