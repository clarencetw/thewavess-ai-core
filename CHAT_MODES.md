# Chat Modes æŒ‡å—

> ğŸ“‹ **ç›¸é—œæ–‡æª”**: å®Œæ•´æ–‡æª”ç´¢å¼•è«‹åƒè€ƒ [DOCS_INDEX.md](./DOCS_INDEX.md)

èŠå¤©æœƒè©±ç›®å‰æ”¯æ´å…©ç¨®æ¨¡å¼ï¼š`chat`ï¼ˆé è¨­ï¼‰èˆ‡ `novel`ã€‚æ¨¡å¼æ§åˆ¶ Prompt æŒ‡å¼•èˆ‡è¼¸å‡ºé¢¨æ ¼ï¼Œä½† NSFW åˆ†ç´šèˆ‡å¼•æ“è·¯ç”±å¦ç”± `ChatService` è™•ç†ã€‚

## 1. æ¨¡å¼ç¸½è¦½
| æ¨¡å¼ | ç‰¹è‰² | å…¸å‹ç”¨é€” | é è¨­å­—æ•¸ | Prompt æŒ‡å¼•ä¾†æº |
|------|------|----------|-----------|------------------|
| `chat` | è¼•é¬†äº’å‹•ã€å¥å­ç²¾ç°¡ã€æº«æš–é™ªä¼´ | æ—¥å¸¸èŠå¤©ã€å¿«é€Ÿå›æ‡‰ | ç´„ 100 å­— | `BasePromptBuilder.GetModeGuidance`ï¼ˆchat åˆ†æ”¯ï¼‰|
| `novel` | æ–‡å­¸åŒ–æ•˜äº‹ã€æ®µè½è±å¯Œã€æ²‰æµ¸å¼é«”é©— | æ•˜äº‹å‹äº’å‹•ã€è§’è‰²æ‰®æ¼” | ç´„ 300 å­— | `BasePromptBuilder.GetModeGuidance`ï¼ˆnovel åˆ†æ”¯ï¼‰|

## 2. Prompt å·®ç•°
| å…ƒç´  | `chat` æ¨¡å¼ | `novel` æ¨¡å¼ |
|------|-------------|--------------|
| çµæ§‹ | `*å‹•ä½œ* + å°è©±` | `*å‹•ä½œ* â†’ å°è©± â†’ *å‹•ä½œ* ...` å¤šæ®µè½ |
| é‡é» | æƒ…æ„Ÿé€£çµã€é™ªä¼´æ„Ÿ | å ´æ™¯æå¯«ã€å¿ƒç†åˆ»ç•«ã€æ°›åœç‡Ÿé€  |
| èªæ°£ | è¦ªè¿‘ã€å£èªåŒ– | æ–‡å­¸æ•˜äº‹ã€ç´°è†©æå¯« |
| å‹•ä½œæè¿° | ç°¡æ½”ã€å¼·èª¿è¦ªå¯†ç´°ç¯€ | è©³ç›¡ï¼Œå«ç’°å¢ƒèˆ‡å¤šæ„Ÿå®˜ç´°ç¯€ |
| è¦–è§’ | å°è©±å°å‘ | ç¬¬ä¸‰äººç¨±æ•˜è¿°ã€èˆå°åŒ–å‘ˆç¾ |

## 3. å¼•æ“æ­é…
| æ¨¡å¼ | OpenAI (L1-L3) | Grok (L4-L5) |
|------|----------------|--------------|
| `chat` | ä½¿ç”¨ OpenAI å°ˆç”¨ promptï¼Œæ³¨é‡æƒ…æ„Ÿæ™ºæ…§èˆ‡é™ªä¼´ç¯€å¥ | ä½¿ç”¨ Grok å°ˆç”¨ promptï¼Œä¿ç•™è§’è‰²èªæ°£ä¸¦å¼·èª¿å‰µæ„ |
| `novel` | å°èªªæ•˜äº‹æ¨¡æ¿ï¼Œè¼¸å‡ºé•·ç¯‡æ®µè½èˆ‡å¿ƒç†æå¯« | æ”¾å¤§æ–‡å­¸é¢¨æ ¼ï¼ŒåŒæ™‚éµå®ˆ NSFW å°å¼•èˆ‡è§’è‰²è¨­å®š |

## 4. AI å›æ‡‰ JSON åˆç´„
> ä¾†æºï¼š`services/prompt_base.go:GetStrictJSONContract`ã€‚ç„¡è«–ä½¿ç”¨å“ªç¨®æ¨¡å¼æˆ–è§’è‰²ï¼ŒAI æœ€çµ‚è¼¸å‡ºéƒ½å¿…é ˆç¬¦åˆä¸‹åˆ— JSON çµæ§‹ã€‚

| æ¬„ä½ | å¿…å¡« | å…è¨±å€¼ / ç¯„ä¾‹ | èªªæ˜ |
|------|------|----------------|------|
| `content` | âœ… | `"*å‹•ä½œ*å°è©±å…§å®¹"` | éœ€åŒæ™‚åŒ…å« `*å‹•ä½œ*` èˆ‡å¯¦éš›å°è©±ï¼›è«‹ä¿æŒç•«é¢æ„Ÿèˆ‡ç´°ç¯€ã€‚ |
| `emotion_delta.affection_change` | âœ… | `-10` ~ `+10` | æ§åˆ¶å¥½æ„Ÿåº¦è®ŠåŒ–ï¼›ç¼ºå€¼æ™‚å¾Œç«¯æœƒ fallback 0 æˆ– 1ã€‚ |
| `mood` | âœ… | `neutral / happy / excited / shy / romantic / passionate / pleased / loving / friendly / polite / concerned / annoyed / upset / disappointed` | åƒ…èƒ½é¸æ“‡åˆ—å‡ºçš„å¿ƒæƒ…ã€‚ |
| `relationship` | âœ… | `stranger / friend / close_friend / lover / soulmate` | å°æ‡‰ `relationships.relationship` æ¬„ä½ã€‚ |
| `intimacy_level` | âœ… | `distant / friendly / close / intimate / deeply_intimate` | å°æ‡‰ `relationships.intimacy_level`ã€‚ |
| `reasoning` | â­•ï¸ | ä»»æ„å­—ä¸² | èªªæ˜å›æ‡‰åŸå› ï¼Œå¯ç•™ç©ºã€‚ |

**é™åˆ¶**ï¼š
- å¿…é ˆè¼¸å‡ºã€Œç´” JSONã€ï¼Œä¸å¯æ·»åŠ  Markdown code block æˆ–é¡å¤–æ–‡å­—ã€‚
- å³ä½¿ Prompt è¦æ±‚å…¶ä»–æ¬„ä½ï¼ŒAI ä»æœƒè¢«æ­¤åˆç´„æª¢æŸ¥ï¼›ä¸ç¬¦åˆè€…æœƒè¢«å¾Œç«¯è¦–ç‚ºè§£æå¤±æ•—ã€‚

## 5. æ¨¡å¼è¨­å®šæ–¹å¼
| æ“ä½œ | èªªæ˜ |
|------|------|
| å»ºç«‹æœƒè©± | `POST /api/v1/chats` æ™‚ `chat_mode` ç•™ç©º â†’ é è¨­ `chat` |
| åˆ‡æ›æ¨¡å¼ | `PUT /api/v1/chats/{chat_id}/mode`ï¼ŒBody ç¯„ä¾‹ï¼š`{"chat_mode": "novel"}` |
| æŸ¥è©¢æ¨¡å¼ | `GET /api/v1/chats/{chat_id}` å›å‚³çš„ `chat_mode` æ¬„ä½ |

## 6. æ³¨æ„äº‹é …
| é …ç›® | èªªæ˜ |
|------|------|
| æ¨¡å¼æŒä¹…æ€§ | æ¨¡å¼å­˜æ–¼ `chats.chat_mode`ï¼ŒåŒä¸€æœƒè©±æŒçºŒç”Ÿæ•ˆï¼Œé™¤éæ‰‹å‹•åˆ‡æ› |
| NSFW åˆ†ç´š | æ¨¡å¼ä¸æœƒæ”¹è®Š NSFW åˆ¤å®šï¼›åˆ†ç´šçµæœä»ç”±èªæ„æª¢æ¸¬æ±ºå®š |
| æ­·å²æ‘˜è¦ | Prompt æœƒä¾æ¨¡å¼èª¿æ•´ç¤ºä¾‹ï¼Œä½†å–æ¨£æœ€è¿‘ 5~6 ç­†è¨Šæ¯çš„é‚è¼¯ç›¸åŒ |
| å¼•æ“ç›¸å®¹ | å…©ç¨®æ¨¡å¼çš†æ”¯æ´ OpenAI / Grokï¼›Mistral ç›®å‰ä¿ç•™ä»‹é¢ï¼ˆé è¨­ä¸å•Ÿç”¨ï¼‰|

---
è‹¥æ–°å¢æ¨¡å¼æˆ–èª¿æ•´ JSON åˆç´„å…§å®¹ï¼Œè«‹åŒæ­¥æ›´æ–° `BasePromptBuilder`ã€å‰ç«¯ `chat_mode` æ§åˆ¶åŠæœ¬æ–‡ä»¶ï¼Œé¿å…æ–‡ä»¶èˆ‡å¯¦ä½œä¸ä¸€è‡´ã€‚
