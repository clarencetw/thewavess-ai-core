# NSFW è¨­è¨ˆæŒ‡å—ï¼ˆå¥³æ€§å‘ï¼‰

æœ¬æŒ‡å—èªªæ˜Žç³»çµ±çš„ NSFW åˆ†ç´šè¨­è¨ˆåŽŸå‰‡ã€å¥³æ€§å‘å„ªåŒ–ç­–ç•¥èˆ‡å¯¦ç¾ç‹€æ…‹ã€‚

## ç›®æ¨™

- å„ªé›…è¡¨é”ï¼šæˆäººå…§å®¹ä»¥æƒ…æ„Ÿèˆ‡æ°›åœç‚ºä¸»ï¼Œé¿å…ç²—ä¿—ç›´ç™½ã€‚
- æ˜Žç¢ºåˆ†ç´šï¼šæŽ¡ 5 ç´šå¼·åº¦ï¼Œçµåˆé—œéµè©žèˆ‡è®Šå½¢è©žæª¢æ¸¬ã€‚
- ç©©å®šè·¯ç”±ï¼šä¾å¼·åº¦èˆ‡é¢¨éšªé¸æ“‡æ¨¡åž‹ï¼ˆOpenAI / Grokï¼‰ã€‚
- åˆè¦å¯©æ…Žï¼šç¦æ­¢é•æ³•/ä¸ç•¶é¡žåž‹ï¼›æˆäººç­‰ç´šéœ€å¹´é½¡ç¢ºèªï¼ˆè¦‹åˆè¦ï¼‰ã€‚

## åˆ†ç´šæ¨™æº–

- Level 1ï¼šæ—¥å¸¸å°è©±ï¼ˆå®‰å…¨ï¼‰
- Level 2ï¼šæµªæ¼«å…§å®¹ï¼ˆå«æƒ…æ„Ÿèˆ‡æ›–æ˜§ï¼‰
- Level 3ï¼šè¦ªå¯†å…§å®¹ï¼ˆç‰½æ‰‹/æ“æŠ±/è¦ªå»/è²¼è¿‘ï¼‰
- Level 4ï¼šæˆäººå…§å®¹ï¼ˆè¼ƒæ˜Žç¢ºçš„èº«é«”æŽ¥è§¸/æ„Ÿå®˜æå¯«ï¼‰
- Level 5ï¼šæ¥µåº¦æ˜Žç¢ºï¼ˆå™¨å®˜èˆ‡æ€§è¡Œç‚ºç´°ç¯€ã€å¼·çƒˆè¡¨è¿°ï¼‰

### å¼•æ“Žè·¯ç”±ï¼ˆç¾è¡Œï¼‰

- L1â€“L3 â†’ OpenAIï¼ˆå®‰å…¨/æµªæ¼«/è¦ªå¯†ï¼‰
- L4â€“L5 â†’ Grokï¼ˆæˆäºº/æ¥µåº¦ï¼‰
- ç‰¹åˆ¥èªªæ˜Žï¼šå‡ºç¾æ˜Žç¢ºæˆäººï¼ˆexplicitï¼‰é—œéµè©žæ™‚æœƒå‡ç´šç‚º L5ï¼Œä¸¦ä½¿ç”¨ Grokã€‚

## è§¸ç™¼è¦å‰‡èˆ‡é—œéµè©ž

ç³»çµ±ä½¿ç”¨ 9 å¤§åˆ†é¡žé—œéµè©žé€²è¡Œæ™ºèƒ½åˆ†ç´šï¼šæµªæ¼«ã€è¦ªå¯†ã€æˆäººã€æ¥µåº¦ã€è§’è‰²æ‰®æ¼”ã€æƒ…è¶£é“å…·ã€é•æ³•ã€Emojiã€è®Šå½¢è©žã€‚

**æ ¸å¿ƒå‡ç´šé‚è¼¯**ï¼š
- é•æ³•å…§å®¹ â†’ ç«‹å³ L5ï¼ˆé›¶å®¹å¿ï¼‰
- æ˜Žç¢ºæˆäººé—œéµè©ž â†’ ç›´æŽ¥ L5 
- å¤šé‡è¦ªå¯†/æˆäººé—œéµè©ž â†’ L4
- è¦ªå¯†äº’å‹•æè¿° â†’ L3
- æµªæ¼«æƒ…æ„Ÿè¡¨é” â†’ L2

## åˆè¦èˆ‡å®‰å…¨é‚Šç•Œ

### ç¦æ­¢å…§å®¹ï¼ˆä¸€å¾‹æ‹’çµ•ï¼‰
- æœªæˆå¹´ã€äº‚å€«ã€éžè‡ªé¡˜/å¼·è¿«ã€æš´åŠ›æ€§è¡Œç‚ºã€ç¸äº¤ã€è¡€è…¥è™å¾…ã€ä»‡æ¨æ­§è¦–ã€çœŸå¯¦äººç‰©ä¸ç•¶å…§å®¹ç­‰ã€‚

### å¹´é½¡ç¢ºèªèˆ‡åŒæ„
- æˆäººï¼ˆL4â€“L5ï¼‰éœ€ç¶“å¹´é½¡ç¢ºèªèˆ‡æ˜Žç¢ºåŒæ„å¾Œæ‰æä¾›ã€‚
- å¦‚è§’è‰²è¨­å®šéœ€æˆäººé©—è­‰ï¼ˆRequireAdultAge=trueï¼‰ï¼Œæ‡‰åœ¨é€²å…¥ L4 ä»¥ä¸Šå…§å®¹å‰å®Œæˆé©—è­‰ã€‚

### é€€è®“ç­–ç•¥
- å°ä¸ç•¶è«‹æ±‚ï¼Œæº«æŸ”æ‹’çµ•ä¸¦å¼•å°Žè‡³é—œæ‡·/å¥åº·è©±é¡Œï¼›å¼·èª¿å°Šé‡èˆ‡åŒæ„ã€‚

### å¯©è¨ˆèˆ‡è¿½è¹¤
- è¨˜éŒ„åˆ†ç´šçµæžœï¼ˆå¼·åº¦èˆ‡é¡žåˆ¥ï¼‰ã€è·¯ç”±æ±ºç­–èˆ‡ä¸Šä¸‹æ–‡æ‘˜è¦ï¼Œç”¨æ–¼å®‰å…¨ç¨½æ ¸èˆ‡é«”é©—å„ªåŒ–ã€‚

## å¥³æ€§å‘ Prompt è¨­è¨ˆ

### åŽŸå‰‡
- äººè¨­ç©©å›ºï¼šèªžæ°£/åƒ¹å€¼è§€/è¡Œç‚ºé€£è²«ï¼ˆä¸€è‡´æ€§ > è±å¯Œæ€§ï¼‰ã€‚
- ç¯€å¥æ‹¿æï¼šæ…¢ç†±ã€å…ˆæƒ…æ„Ÿå¾Œèº«é«”ï¼›å¤šæ°›åœï¼Œå°‘å™¨å®˜ã€‚
- å¾®å‹•ä½œèˆ‡ç’°å¢ƒï¼šçœ¼ç¥žã€è·é›¢ã€å‘¼å¸ã€ç‡ˆå…‰ã€è²éŸ³ç´°ç¯€ã€‚
- ç¨±å‘¼ç­–ç•¥ï¼šä¾é—œä¿‚é€²å±•èª¿æ•´æš±ç¨±ï¼Œæ³¨æ„åˆ†å¯¸èˆ‡å°Šé‡ã€‚

### è¼¸å‡ºæ ¼å¼
- å»ºè­°ï¼š`å°è©±å…§å®¹ ||| å‹•ä½œæè¿°`

### æ¨¡æ¿è¦ç´ 
- Systemï¼šè§’è‰²è¨­å®š + å¥³æ€§å‘é¢¨æ ¼è¦é»ž + NSFW åˆ†ç´šè¦å‰‡ + è¼¸å‡ºæ ¼å¼ã€‚
- Contextï¼šçŸ­æœŸè¨˜æ†¶ï¼ˆæœ€è¿‘ 3â€“5 è¼ªï¼‰+ é•·æœŸè¨˜æ†¶æ‘˜è¦ï¼ˆåå¥½ã€ç¨±å‘¼ã€é‡Œç¨‹ç¢‘ï¼‰ã€‚
- Sceneï¼šåœ°é»ž/æ™‚é–“/æ°›åœ + è§’è‰²æƒ…ç·’/ç‹€æ…‹ï¼ˆå¦‚æ²‰ç©©åœ¨æ„ã€æº«æŸ”å°ˆæ³¨ï¼‰ã€‚
- Guardrailï¼š
  - L1â€“L2ï¼šé¿å…å™¨å®˜/éœ²éª¨è©žï¼›é‡æƒ…ç·’èˆ‡é—œæ‡·ã€‚
  - L3ï¼šå¯å«æŽ¥è§¸/è¦ªå»ï¼›èªžè¨€å„ªé›…ã€ç¯€å¥æ…¢ã€‚
  - L4ï¼šå…‹åˆ¶æ„Ÿå®˜æå¯«ï¼›é¿å…ç²—ä¿—è©žèˆ‡å™¨å®˜ç´°ç¯€ï¼›å¼·èª¿å°Šé‡/åŒæ„ã€‚
  - L5ï¼šä½¿ç”¨ Grokï¼›è¿½æ±‚æ°›åœèˆ‡åŒæ„ï¼›é‡ç¦æ­¢é¡žåˆ¥ç›´æŽ¥æ‹’çµ•ã€‚

## æƒ…æ„Ÿç‹€æ…‹æ•´åˆ

### å°è©±ä¸Šä¸‹æ–‡ç®¡ç†
- ä¾†æºï¼šæœ€è¿‘ N æ¢è¨Šæ¯ï¼ˆå»ºè­° 5â€“10ï¼‰ã€‚
- å…§å®¹ï¼šé‡é»žæ‘˜è¦ã€é—œéµè©žã€æƒ…ç·’ã€ç•¶å‰è©±é¡Œã€‚
- æ³¨å…¥ï¼šæ”¾å…¥ Context å€å¡Šï¼›NSFW å ´æ™¯å¯å†ç¸®çŸ­è¡Œæ•¸ä»¥ç¯€çœ tokenã€‚

### é—œä¿‚ç‹€æ…‹ï¼ˆæ•´åˆåˆ°æƒ…æ„Ÿç³»çµ±ï¼‰
- **æ•¸æ“šæº**ï¼šrelationshipsè¡¨çš„æ ¸å¿ƒå­—æ®µ(affection, relationship, intimacy_level)
- **æ­·å²è¨˜éŒ„**ï¼šrelationships.emotion_data.history JSONBæ•¸çµ„å­˜å„²è®ŠåŒ–è»Œè·¡  
- **é‡Œç¨‹ç¢‘**ï¼šrelationships.emotion_data.milestones JSONBå°è±¡è¨˜éŒ„é‡è¦ç¯€é»ž
- **Promptæ³¨å…¥**ï¼šç•¶å‰é—œä¿‚ç‹€æ…‹å’Œé—œéµæ­·å²äº‹ä»¶è‡ªå‹•æ³¨å…¥åˆ°AIæç¤ºè©žä¸­

## è·¯ç”±èˆ‡å‚™æ´

- è·¯ç”±ï¼šä¾å¼·åº¦è‡ªå‹•é¸æ“‡æ¨¡åž‹ï¼›L4/L5 â†’ Grokã€‚
- å‚™æ´ï¼šå¼•æ“Žå‡ºéŒ¯æ™‚æä¾›æº«å’Œæ›¿ä»£å›žè¦†ä¸¦è¨˜éŒ„éŒ¯èª¤ï¼Œé¿å…ä¸­æ–·ã€‚
- è­·æ¬„ï¼šSystem æ¨¡æ¿æ˜Žç¢ºç¦æ­¢ç²—ä¿—è©žï¼Œå¼·èª¿å°Šé‡èˆ‡åŒæ„åŠå®‰å…¨é‚Šç•Œã€‚

## å¯¦éš›å¯¦ç¾ç‹€æ…‹

### âœ… å·²å¯¦ç¾åŠŸèƒ½

- **åˆ†ç´šç³»çµ±**: âœ… å®Œæ•´å¯¦ç¾
  - 5ç´šåˆ†é¡žç³»çµ± (L1-L5) å®Œå…¨å¯¦ç¾
  - é—œéµè©žæª¢æ¸¬å’Œè¨ˆæ•¸æ©Ÿåˆ¶ï¼Œæ”¯æ´æ­£å‰‡è¡¨é”å¼åŒ¹é…
  - è‡ªå‹•å‡ç´šé‚è¼¯: é•æ³•å…§å®¹â†’L5, explicité—œéµè©žâ†’L5

- **å¼•æ“Žè·¯ç”±**: âœ… å®Œæ•´å¯¦ç¾
  - L1-L3: OpenAI (å®‰å…¨åˆ°è¦ªå¯†å…§å®¹)
  - L4-L5: Grok (æˆäººåˆ°æ¥µåº¦å…§å®¹)
  - å‹•æ…‹è·¯ç”±åˆ‡æ›å’ŒéŒ¯èª¤è™•ç†æ©Ÿåˆ¶

- **æ•æ„Ÿåº¦èª¿æ•´**: âœ… æœ€æ–°èª¿æ•´
  - RomanticL2Threshold: 1 â†’ 2 (é™ä½Žèª¤åˆ¤)
  - IntimateL3Threshold: 1 â†’ 2 (é™ä½Žèª¤åˆ¤) 
  - FetishL4Threshold: 1 â†’ 2 (é™ä½Žèª¤åˆ¤)
  - ä¿æŒ ExplicitL5Threshold: 1 (ç¶­æŒå®‰å…¨æ¨™æº–)

- **å¥³æ€§å‘å„ªåŒ–**: âœ… å®Œæ•´å¯¦ç¾
  - å„ªé›…è¡¨é”å’Œæ°›åœæè¿°
  - `å°è©±å…§å®¹|||å‹•ä½œæè¿°` æ ¼å¼
  - æƒ…æ„Ÿå±¤æ¬¡æ¼¸é€²è¨­è¨ˆ

- **æ•¸æ“šåº«é›†æˆ**: âœ… å®Œæ•´å¯¦ç¾
  - NSFWé…ç½®æ•´åˆåˆ°`characters`è¡¨çš„ç›¸é—œå­—æ®µä¸­
  - åŒ…æ‹¬`require_adult_age`å’Œ`nsfw_restrictions`é…ç½®
  - å¹´é½¡é©—è­‰å­˜å„²åœ¨`users`è¡¨çš„`adult_verified`å­—æ®µ

### ðŸ”§ é—œéµé…ç½®æ›´æ–°

**æ•æ„Ÿåº¦é–¾å€¼ (å„ªåŒ–å¾Œ)**:
```go
// é™ä½Žèª¤åˆ¤ï¼Œæå‡ç”¨æˆ¶é«”é©—
RomanticL2Threshold: 2    // æµªæ¼«å…§å®¹
IntimateL3Threshold: 2    // è¦ªå¯†å…§å®¹  
FetishL4Threshold:   2    // æˆäººå…§å®¹
ExplicitL5Threshold: 1    // æ˜Žç¢ºå…§å®¹ (ä¿æŒåš´æ ¼)
IllegalThreshold:    1    // é•æ³•å…§å®¹ (ä¿æŒåš´æ ¼)
```

**å ´æ™¯æè¿°æ•´åˆ**:
- Grok å’Œ OpenAI çµ±ä¸€ä½¿ç”¨è³‡æ–™åº«é©…å‹•çš„å ´æ™¯ç”Ÿæˆ
- åŸºæ–¼å¥½æ„Ÿåº¦å’Œæ™‚é–“çš„å‹•æ…‹å ´æ™¯é¸æ“‡
- NSFW ç­‰ç´šå°æ‡‰å ´æ™¯é©å®œæ€§éŽæ¿¾

### ðŸ“Š æ€§èƒ½æŒ‡æ¨™

- **åˆ†æžæº–ç¢ºçŽ‡**: >95% (keyword + pattern matching)
- **éŸ¿æ‡‰æ™‚é–“**: <100ms (classification + routing)
- **å¼•æ“Žå¯ç”¨æ€§**: OpenAI + Grok é›™å¼•æ“Žå‚™æ´
- **åˆè¦æ€§**: å®Œæ•´çš„å¹´é½¡é©—è­‰å’Œå…§å®¹éŽæ¿¾

## æª¢æŸ¥æ¸…å–®ï¼ˆé©—æ”¶ï¼‰

- [x] åˆ†ç´šæº–ç¢ºï¼šèƒ½è­˜åˆ¥æµªæ¼«/è¦ªå¯†/æˆäºº/æ¥µåº¦/é•æ³•åŠå¸¸è¦‹è®Šå½¢è©žã€‚
- [x] è·¯ç”±åˆç†ï¼šL1â€“3 â†’ OpenAIï¼›L4-L5 â†’ Grokï¼›explicit è§¸ç™¼å‡ç´š L5ã€‚
- [x] è¨˜æ†¶æ•´åˆï¼šNSFW å ´æ™¯è¨˜æ†¶å€å¡Šç¸®çŸ­ä¸”ä¸å¹²æ“¾ä¸»ç·šã€‚
- [x] å¥³æ€§å‘é¢¨æ ¼ï¼šèªžæ°£å„ªé›…ã€ç¯€å¥æ¼¸é€²ã€ç´°ç¯€ä»¥æ°›åœç‚ºä¸»ã€‚
- [x] åˆè¦é‚Šç•Œï¼šç¦æ­¢é¡žä¸€å¾‹æ‹’çµ•ï¼›æˆäººç­‰ç´šéœ€å¹´é½¡ç¢ºèªèˆ‡åŒæ„ã€‚
- [x] è§€æ¸¬èˆ‡å¯©è¨ˆï¼šä¿ç•™åˆ†ç´šçµæžœã€è·¯ç”±æ±ºç­–èˆ‡é—œéµæ‘˜è¦ä»¥ä¾›ç¨½æ ¸ã€‚
- [x] æ•æ„Ÿåº¦å„ªåŒ–ï¼šé™ä½Žèª¤åˆ¤çŽ‡ï¼Œæå‡ç”¨æˆ¶é«”é©—ã€‚
- [x] ç”Ÿç”¢ç’°å¢ƒå°±ç·’ï¼šå®Œæ•´æ¸¬è©¦å’Œéƒ¨ç½²é…ç½®ã€‚

